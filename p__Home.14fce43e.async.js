(self.webpackChunktemplate=self.webpackChunktemplate||[]).push([[371],{75941:function(K){K.exports={wrapper:"wrapper___3iih1",header:"header___iRYkE",tags:"tags___j8zxo",chart:"chart___26X92",input:"input___3IKyb"}},83173:function(K,Z,e){"use strict";e.r(Z);var _e=e(71194),$=e(62198),ue=e(77883),z=e(79587),oe=e(71153),p=e(23025),w=e(86582),O=e(2824),x=e(8870),W=e(3182),G=e(94043),C=e.n(G),Q=e(75941),T=e.n(Q),X=e(77793),_=e(67294),H=e(77531),j=e.n(H),J=e(30381),S=e.n(J),o=e(85893),h=window.recordUser||"caoweiwei",q="2022-05-16",I=S()().format("YYYY-MM-DD"),U=function(){var f=[],t=S()(q),r=S()(I);for(f.push(t.format("YYYY-MM-DD"));t.isBefore(r);)t.add(1,"days"),f.push(t.format("YYYY-MM-DD"));return f}(),b={user1:{START:214.8,END:140},user2:{START:145,END:110}},ee=function(){var f=(0,W.Z)(C().mark(function t(){var r;return C().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return r=new(j()).Query("Record"),r.limit(1e3),r.descending("createdAt"),v.abrupt("return",r.find().then(function(M){return M.map(function(u){return(0,x.Z)((0,x.Z)({},u.attributes),{},{objectId:u.id})})}));case 4:case"end":return v.stop()}},t)}));return function(){return f.apply(this,arguments)}}(),re=function(t,r){if(!t.length)return[];for(var P=[],v=t.slice(0,r||void 0).reverse().find(function(E){return E.user1}).user1,M=t.slice(0,r||void 0).reverse().find(function(E){return E.user2}).user2,u=function(i,l){return i&&+((b[l].START-i)/(b[l].START-b[l].END)*100).toFixed(2)},g=function(i){var l=U[i],c=t.find(function(A){return A.time===l});c!=null&&c.user1&&(v=c.user1),c!=null&&c.user2&&(M=c.user2),P.push({time:l,user:"VV",value:u(v,"user1")}),P.push({time:l,user:"B",value:u(M,"user2")})},R=r&&U.length>r?U.length-r:0;R<U.length;R++)g(R);return P};Z.default=function(){var f=(0,_.useState)([]),t=(0,O.Z)(f,2),r=t[0],P=t[1],v=(0,_.useState)([]),M=(0,O.Z)(v,2),u=M[0],g=M[1],R=(0,_.useState)(7),E=(0,O.Z)(R,2),i=E[0],l=E[1],c=(0,_.useState)(),A=(0,O.Z)(c,2),y=A[0],L=A[1],te=(0,_.useState)(!1),N=(0,O.Z)(te,2),Y=N[0],k=N[1],a=(0,_.useMemo)(function(){return r.find(function(n){return n.time===I})},[r]),V=(0,_.useCallback)((0,W.Z)(C().mark(function n(){var d,s;return C().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,ee();case 2:s=m.sent,L((d=s.find(function(se){return se.time===I}))===null||d===void 0?void 0:d[h]),P(s);case 5:case"end":return m.stop()}},n)})),[]);(0,_.useEffect)(function(){setInterval(function(){window.location.reload()},1e3*60*60),V()},[V]),(0,_.useEffect)(function(){g(re(r,i))},[i,r]);var ae=(0,_.useState)(),F=(0,O.Z)(ae,2),D=F[0],ne=F[1];return(0,_.useEffect)(function(){var n=new X.kL({container:"mountNode",autoFit:!0});ne(n)},[]),(0,_.useEffect)(function(){if(D){D.clear(),D.data(u);var n=Math.min.apply(Math,(0,w.Z)(u.map(function(s){return s.value})))-1,d=Math.max.apply(Math,(0,w.Z)(u.map(function(s){return s.value})))+1;D.scale("value",{min:n,max:d,formatter:function(B){return"".concat(B,"%")},tickCount:u.length>20?20:u.length}),D.line().position("time*value").color("user").shape("smooth"),D.point().position("time*value").color("user").size(4).shape("circle").style({stroke:"#fff",lineWidth:1}),D.render()}},[D,u]),(0,o.jsxs)("div",{className:T().wrapper,children:[(0,o.jsxs)("div",{className:T().header,children:[(0,o.jsxs)("div",{className:T().tags,children:[(0,o.jsx)(p.Z,{onClick:function(){l(7)},color:i===7?"#87d068":"",children:"7\u5929"}),(0,o.jsx)(p.Z,{onClick:function(){l(30)},color:i===30?"#87d068":"",children:"30\u5929"}),(0,o.jsx)(p.Z,{onClick:function(){l(0)},color:i===0?"#87d068":"",children:"\u5168\u90E8"})]}),h==="user1"&&(0,o.jsx)(p.Z,{color:"rgb(93 217 168)",children:a!=null&&a.user2?a.user2:"\u6682\u672A\u5F55\u5165"}),(0,o.jsx)(p.Z,{color:h==="user1"?"rgb(91 143 249)":"rgb(93 217 168)",onClick:function(){k(!Y)},children:a!=null&&a[h]?a[h]:"\u70B9\u51FB\u5F55\u5165"})]}),(0,o.jsx)("div",{id:"mountNode",className:T().chart}),(0,o.jsx)($.Z,{visible:Y,onCancel:function(){k(!1),L(a==null?void 0:a[h])},onOk:(0,W.Z)(C().mark(function n(){var d,s;return C().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return d=j().Object.extend("Record"),s=new d,a!=null&&a.objectId&&(s=j().Object.createWithoutData("Record",a.objectId)),s.set("time",I),s.set(h,y),m.next=7,s.save();case 7:window.location.reload();case 8:case"end":return m.stop()}},n)})),children:(0,o.jsx)(z.Z,{autoFocus:!0,className:T().input,value:y||void 0,onChange:function(d){L(d)}})})]})}}}]);
