(self.webpackChunktemplate=self.webpackChunktemplate||[]).push([[371],{75941:function(B){B.exports={wrapper:"wrapper___3iih1",header:"header___iRYkE",tags:"tags___j8zxo",chart:"chart___26X92",input:"input___3IKyb"}},83173:function(B,K,e){"use strict";e.r(K);var oe=e(71194),F=e(62198),ue=e(77883),z=e(79587),_e=e(71153),P=e(23025),Z=e(86582),p=e(2824),x=e(8870),b=e(3182),G=e(94043),O=e.n(G),H=e(75941),T=e.n(H),Q=e(77793),o=e(67294),X=e(77531),W=e.n(X),J=e(30381),j=e.n(J),i=e(85893),v=window.recordUser||"caoweiwei",q="2022-05-16",R=j()().format("YYYY-MM-DD"),U=function(){var E=[],n=j()(q),t=j()(R);for(E.push(n.format("YYYY-MM-DD"));n.isBefore(t);)n.add(1,"days"),E.push(n.format("YYYY-MM-DD"));return E}(),L={user1:{START:214.8,END:140},user2:{START:145,END:110}},ee=function(){var E=(0,b.Z)(O().mark(function n(){var t;return O().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return t=new(W()).Query("Record"),t.limit(1e3),t.descending("createdAt"),f.abrupt("return",t.find().then(function(M){return M.map(function(u){return(0,x.Z)((0,x.Z)({},u.attributes),{},{objectId:u.id})})}));case 4:case"end":return f.stop()}},n)}));return function(){return E.apply(this,arguments)}}(),te=function(n,t){if(!n.length)return[];for(var C=[],f=n.slice(0,t||void 0).reverse().find(function(h){return h.user1}).user1,M=n.slice(0,t||void 0).reverse().find(function(h){return h.user2}).user2,u=function(l,d){return l&&+((L[d].START-l)/(L[d].START-L[d].END)*100).toFixed(2)},S=function(l){var d=U[l],c=n.find(function(A){return A.time===d});c!=null&&c.user1&&(f=c.user1),c!=null&&c.user2&&(M=c.user2),C.push({time:d,user:"VV",value:u(f,"user1")}),C.push({time:d,user:"B",value:u(M,"user2")})},g=t&&U.length>t?U.length-t:0;g<U.length;g++)S(g);return C};K.default=function(){var E=(0,o.useState)([]),n=(0,p.Z)(E,2),t=n[0],C=n[1],f=(0,o.useState)([]),M=(0,p.Z)(f,2),u=M[0],S=M[1],g=(0,o.useState)(7),h=(0,p.Z)(g,2),l=h[0],d=h[1],c=(0,o.useState)(),A=(0,p.Z)(c,2),y=A[0],w=A[1],re=(0,o.useState)(!1),N=(0,p.Z)(re,2),Y=N[0],k=N[1],s=(0,o.useMemo)(function(){return t.find(function(r){return r.time===R})},[t]),V=(0,o.useCallback)((0,b.Z)(O().mark(function r(){var _,a;return O().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,ee();case 2:a=m.sent,w((_=a.find(function(se){return se.time===R}))===null||_===void 0?void 0:_[v]),C(a);case 5:case"end":return m.stop()}},r)})),[]);(0,o.useEffect)(function(){setInterval(function(){window.location.reload()},1e3*60*60),V()},[V]),(0,o.useEffect)(function(){S(te(t,l))},[l,t]);var ae=(0,o.useState)(),$=(0,p.Z)(ae,2),D=$[0],ne=$[1];return(0,o.useEffect)(function(){var r=new Q.kL({container:"mountNode",autoFit:!0});ne(r)},[]),(0,o.useEffect)(function(){if(D){D.clear(),D.data(u);var r=Math.min.apply(Math,(0,Z.Z)(u.map(function(a){return a.value})))-1,_=Math.max.apply(Math,(0,Z.Z)(u.map(function(a){return a.value})))+1;D.scale("value",{min:r,max:_,formatter:function(I){return"".concat(I,"%")},tickCount:u.length>20?20:u.length}),D.line().position("time*value").color("user").shape("smooth"),D.point().position("time*value").color("user").size(4).shape("circle").style({stroke:"#fff",lineWidth:1}),D.render()}},[D,u]),(0,o.useEffect)(function(){var r,_=((r=t.find(function(I){return I.time==="2022-05-20"}))===null||r===void 0?void 0:r.user2)||v==="user1"&&R==="2022-05-19";if(_){var a=document.createElement("script");a.src="http://demo.frontendx.cn/live2d-example/src/L2Dwidget.min.js",a.onload=function(){window.L2Dwidget.init({model:{jsonPath:"http://demo.frontendx.cn/live2d-example/packages/live2d-widget-model-haru01/assets/haru01.model.json"},display:{position:"right",hOffset:-60,vOffset:-100},mobile:{show:!0,scale:.5},dialog:{enable:!0,script:{"tap body":"520 mua~mua~mua~"}}})},document.body.appendChild(a)}},[t]),(0,i.jsxs)("div",{className:T().wrapper,children:[(0,i.jsxs)("div",{className:T().header,children:[(0,i.jsxs)("div",{className:T().tags,children:[(0,i.jsx)(P.Z,{onClick:function(){d(7)},color:l===7?"#87d068":"",children:"7\u5929"}),(0,i.jsx)(P.Z,{onClick:function(){d(30)},color:l===30?"#87d068":"",children:"30\u5929"}),(0,i.jsx)(P.Z,{onClick:function(){d(0)},color:l===0?"#87d068":"",children:"\u5168\u90E8"})]}),v==="user1"&&(0,i.jsx)(P.Z,{color:"rgb(93 217 168)",children:s!=null&&s.user2?s.user2:"\u6682\u672A\u5F55\u5165"}),(0,i.jsx)(P.Z,{color:v==="user1"?"rgb(91 143 249)":"rgb(93 217 168)",onClick:function(){k(!Y)},children:s!=null&&s[v]?s[v]:"\u70B9\u51FB\u5F55\u5165"})]}),(0,i.jsx)("div",{id:"mountNode",className:T().chart}),(0,i.jsx)(F.Z,{visible:Y,onCancel:function(){k(!1),w(s==null?void 0:s[v])},onOk:(0,b.Z)(O().mark(function r(){var _,a;return O().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return _=W().Object.extend("Record"),a=new _,s!=null&&s.objectId&&(a=W().Object.createWithoutData("Record",s.objectId)),a.set("time",R),a.set(v,y),m.next=7,a.save();case 7:window.location.reload();case 8:case"end":return m.stop()}},r)})),children:(0,i.jsx)(z.Z,{autoFocus:!0,className:T().input,value:y||void 0,onChange:function(_){w(_)}})})]})}}}]);
